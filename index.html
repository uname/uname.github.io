<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Uname&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Uname's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Uname's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Uname's blog">
<meta name="twitter:description">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <a id="logo" class="logo logo-text" href="/">uname&#39;s blog</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer">
      <article id="post-tcp2com-debug" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/19/tcp2com-debug/">一种嵌入式设备数据的实时无线观察方法</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/19/tcp2com-debug/" class="article-date">
  <time datetime="2016-02-19T08:15:05.000Z" itemprop="datePublished">2016-02-19</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp;笔者有一块STM32的开发板，需要读取MPU6050的姿态数据。这些数据在经过均值和卡尔曼滤波等处理后，得到一些角度数据。这些角度数据对笔者进行的开发调试非常重要，因此需要一种可以实时观察这些数据的手段。<br>最简单的方式是通过一根串口线连接到PC，打开PC端的串口数据处理软件即可。但这样会有一根数据线，数据线的存在造成的物理抖动会干扰到这些数据，并且会阻碍开发板在更大的空间内自由移动。因此需要寻找无线的解决方案。</p>
<p>&emsp;&emsp;笔者使用如下方式，通过WiFi获取开发板数据并在PC端的RealtimePlotter软件上显示数据波形。<br><img src="/images/com2tcp-debug/solution.png" alt=""></p>
<ol>
<li>Serial&lt;-&gt;Tcp Bridge用来将开发板的串口数据通过桥接的方式提供给通过TCP连接的COM2TCP。这里的Serial&lt;-&gt;Tcp Bridge笔者使用一个运行在安装了OpenWRT系统开发板上的Linux进程（sock2serial）。</li>
<li>COM2TCP是一个可以Windows系统上桥接网络和串口通信的工具，<a href="http://astrogeeks.com/AstroGeeks/COM2TCP/download.html" target="_blank" rel="external">下载地址</a>。下载完成后打开，可看到如下的设置界面：<br><img src="/images/com2tcp-debug/com2tcp.png" alt="">。<br>将IP和TCP Port配置为Serial&lt;-&gt;Tcp Bridge监听的地址和端口。COM Port选择一个未使用的COM口，单击连接即可。</li>
<li>笔者用来观察波形的软件<a href="https://github.com/uname/RealtimePlotter" target="_blank" rel="external">RealtimePlotter</a>是github上的一个开源工具，使用Processing语言编写。该软件从串口读取数据并绘制波形，支持最大六个通过的数据绘制。<br>数据格式为: “value1 value2 value3 value4 value5 value6\r”。有时间可以把这个工具修改为从TCP服务器读取数据，这样就可以省去COM2TCP了。<br>RealtimePlotter有三个目录，分别为BasicRealtimePlotter、RealtimePlotterArduinoCode和RealtimePlotterWithControlPanel。笔者使用BasicRealtimePlotter，这里需要编辑BasicRealtimePlotter.pde代码，修改在COM2TCP中使用的串口号，如图：<br><img src="/images/com2tcp-debug/comport.png" alt="">。</li>
</ol>
<p>一切准备就绪后，运行BasicRealtimePlotter.pde就可以看到数据了。<br>有几点需要注意：</p>
<ol>
<li>原始数据仍通过串口输出，波特率设置高点可以更快传输数据。</li>
<li>BasicRealtimePlotter软件的数据绘制能力有限，数据太快太多有可能绘制不过来。</li>
</ol>

      
    </div>
  
  </div>
  
</article>



    
      <article id="post-awesome-c-cn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/15/awesome-c-cn/">C 语言资源大全中文版</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/15/awesome-c-cn/" class="article-date">
  <time datetime="2016-02-15T02:54:51.000Z" itemprop="datePublished">2016-02-15</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>C 资源大全中文版，包括了：构建系统、编译器、数据库、加密、初中高的教程/指南、书籍、库等。<br>以下内容均来自其<a href="https://github.com/jobbole/awesome-c-cn" target="_blank" rel="external">jobbole/awesome-c-cn</a><br>感谢jobbole等网友的翻译工作！</p>
<h4 id="传送门"><a href="https://github.com/uname/awesome-c-cn/blob/master/README.md" target="_blank" rel="external">传送门</a></h4>
      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/learn/">learn</a></li></ul>

    </footer>
  
  </div>
  
</article>



    
      <article id="post-nodemcu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/06/nodemcu/">NodeMCU上手笔记</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/06/nodemcu/" class="article-date">
  <time datetime="2016-01-06T06:53:02.000Z" itemprop="datePublished">2016-01-06</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>笔者最近想把开发板的高速传感器数据通过无线的方式传输到PC端进行波形分析，需要一个串口到WiFi的透传模块。之前笔者一直使用路由器刷入OpenWRT的方式来做串口和WiFi的透传，这样摆脱了调试线，又有不错的通信速度，效果还是不错的。</p>
<p>之前了解过NodeMCU，看介绍它也有WiFi和串口，应该可以满足需求，于是在淘宝买了一块做了实验。关于NodeMCU，笔者这里简单说下：<br>NodeMCU是一个基于esp8266的开发板，官方的说法它是一个超简单的物联网开发平台。确实，它有WiFi和串口，上可以连接云主机，下可以通过串口或I2C与其他传感器通信。不过笔者的试用感受，这东西玩玩就行了，很难想象它将来会在物联网上有什么大的成就。<br>不过笔者比较欣赏的是它提供了一套Lua的API，这对之前没有搞过硬件开发的纯软程序员来说是个比较好的切入点。<br>它的官网：<a href="http://www.nodemcu.com/" target="_blank" rel="external">http://www.nodemcu.com/</a><br>它在Github的开源地址：<a href="https://github.com/nodemcu/nodemcu-firmware" target="_blank" rel="external">https://github.com/nodemcu/nodemcu-firmware</a><br>（笔者之前也一度想给STM32开发一套Lua的API，一直没有时间精力去搞 - - !）</p>
<p>一般从淘宝买回来的时候，卖家已经帮忙刷好了固件。不过自己还是要熟悉下过程，再刷一遍：</p>
<h6 id="1-_安装串口驱动">1. 安装串口驱动</h6><p>如果购买的是esp8266模块，则需要一个TTL转串口的模块，按照官方文档接好Rx，Tx，并安装好串口驱动。<br>如果购买的是已经做好的NodeMCU开发板，那USB连接到电脑，并安装好串口驱动就好了。</p>
<h6 id="2-_刷固件">2. 刷固件</h6><p>去NodeMCU的Github项目地址去下载它的固件nodemcu_xxx.bin和烧写工具ESP8266Flasher.exe<br><a href="https://github.com/nodemcu/nodemcu-firmware/releases" target="_blank" rel="external">https://github.com/nodemcu/nodemcu-firmware/releases</a><br><a href="https://github.com/nodemcu/nodemcu-flasher" target="_blank" rel="external">https://github.com/nodemcu/nodemcu-flasher</a></p>
<p>打开ESP8266Flasher，选择NodeMCU使用的串口（一般ESP8266Flasher会自动选择该串口，如果你只连接了这个一个串口设备）。<br>在Config页中的第一个选择框处选择已下载的固件bin文件。<br><img src="/images/nodemcu/nodemcu1.png" alt=""><br>然后切换到Operation页中单击Flash按钮开始烧写。大概3分钟烧写完成，如下图所示：<br><img src="/images/nodemcu/nodemcu2.png" alt=""></p>
<h6 id="3-_测试">3. 测试</h6><p>打开串口工具，选择NodeMCU的串口号，波特率默认9600（暂时没有找到修改方法，可能需要重新编译固件）。<br>打开后，NodeMCU会输出几个乱码（没有的话，可以reset下板子）然后版本号、一行错误提示，和输入提示符。如图：<br><img src="/images/nodemcu/nodemcu3.png" alt=""><br>我们输入一行Lua代码：<br>print(“Hello NodeMCU, This is uname”)<br>可以看到NodeMCU正常执行了该打印语句。</p>
<h6 id="4-_如何做串口到WiFi的串口">4. 如何做串口到WiFi的串口</h6><p>至少有两种方式，一是修改固件代码，从esp8266提供的C API层搞起编译一个自己的专有透传固件。前端时间在一个STM32的论坛看到，已经有人这么做了（不过是Socket通信是UDP，不推荐）。<br>另一种方式就是使用Lua的API写自己的穿透脚本，然后通过串口写入NodeMCU。这样的方式相对简单易行，但有一个问题，如何让自己的脚本在板子启动时自动执行。<br>我们仔细看下上图中的那行错误提示：<br>lua: cannot open init.lua<br>实际上NodeMCU上电后默认会执行init.lua中的代码，因为刷入的固件中并没有init.lua这个文件，所以才会出错。<br>我们先尝试写一行打印语句到init.lua中看看是不是会在上电后默认执行：<br><img src="/images/nodemcu/nodemcu4.png" alt=""><br>可以看到，我们写入init.lua中的代码在上电时自动执行了！<br>于是，我们可以参考官方给出的Lua API：<a href="https://github.com/nodemcu/nodemcu-firmware/wiki/nodemcu_api_cn" target="_blank" rel="external">https://github.com/nodemcu/nodemcu-firmware/wiki/nodemcu_api_cn</a><br>写自己的透传脚本了。</p>
<h6 id="5-_怎么上传脚本到NodeMCU开发板">5. 怎么上传脚本到NodeMCU开发板</h6><p>刚刚没有交代。这里补上，如上图，通过Lua API提供的file模块即可将代码一行一行的写入init.lua。<br>你需要了解一些Lua的语法。</p>
<h6 id="6-_透传脚本">6. 透传脚本</h6><p>笔者已经写好了用于透传的init.lua脚本，并写好了用于上传init.lua的flash.py脚本和用于删除已上传init.lua的clean.py脚本（若要使用该上传和删除脚本，需按照Python环境和pyserial模块）。</p>
<ul>
<li>init.lua：<br><img src="/images/nodemcu/init.lua.png" alt=""></li>
</ul>
<p>不要按照上图重新敲代码，所有代码和工具我都已上传到我的github：<a href="https://github.com/uname/nodemcu-sernet-proxy" target="_blank" rel="external">https://github.com/uname/nodemcu-sernet-proxy</a></p>
<p>使用flash.py上传init.lua：<br><img src="/images/nodemcu/upload.png" alt=""></p>
<p>上传完成后重新在串口工具中打开串口：<br><img src="/images/nodemcu/nodemcu6.png" alt=""></p>
<p>此时你从串口敲入的Lua语句不再被执行，而是直接转发到通过TCP连接到NodeMCU服务器的客户端！<br>以后该脚本一上电，init.lua脚本执行，进入透传模式。再也无法像刚开始那样愉快的输入Lua语句执行了，如果要回到之前那样，执行执行clean.py脚本。</p>
<p>记住一下几点：</p>
<ul>
<li>透传模式下NodeMCU的WiFI工作在AP模式，网络SSID一般为ESP_XXXXXX，密码为空</li>
<li>串口波特率貌似只能为9600</li>
<li>串口发送的数据必须以\r或\n结尾开会被转发（转发出去的数据中会去除\r\n）</li>
</ul>
<p>玩Arduino的同学可以用这个转发脚本搞一个WiFi控制的小车哦：）</p>

      
    </div>
  
  </div>
  
</article>



    
      <article id="post-newyear2016" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/31/newyear2016/">2015++</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/12/31/newyear2016/" class="article-date">
  <time datetime="2015-12-31T07:30:50.000Z" itemprop="datePublished">2015-12-31</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>此刻，办公室下午三点半起来活动的广播响起。<br>记得这个活动在12年发起，不知不觉的光阴流转，忽然已是2015的最后一天！<br>深圳的冬天，没有一丝冷意。办公室的暖气甚至一度让我觉得闷热，但在此刻，我却感到了阵阵冷意，那是一种失落时由内而外的刺痛。<br>窗外，依旧是记忆中的模样——常年绿色的行道树、匆忙的车流、还有深圳楼市野蛮生长的喧闹……<br>从未在新年来临时如此不舍，愿2016工作顺心，身体健康，家人平安，更祝愿亲爱的一切都好……</p>
<p><img src="images/newyear2016/IMG_20150911_185636.jpg" alt="Long Beach. LA. USA(拍摄于15年911纪念日)" width="40%"></p>

      
    </div>
  
  </div>
  
</article>



    
      <article id="post-pi2-i2c-MPU6050" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/20/pi2-i2c-MPU6050/">树莓派2通过I2C访问MPU6050</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/12/20/pi2-i2c-MPU6050/" class="article-date">
  <time datetime="2015-12-20T06:16:47.000Z" itemprop="datePublished">2015-12-20</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>笔者最近做了一个平衡车，主要用到了STM32F10x + MPU9250 + FreeRTOS。<br>手边正好还有一块MPU6050的模块和树莓派2，就趁热打铁先把树莓派访问MPU6050的路走通，以便后面需要时查阅。</p>
<h6 id="1-_首先要启动树莓派的I2C功能">1. 首先要启动树莓派的I2C功能</h6><p>sudo mount /dev/mmcblk0p1 /mnt/<br>cd /mnt<br>sudo vim config.txt</p>
<p>找到下面两行<br><img src="/images/pi2-I2C-MPU6050/1.png" alt=""><br>将注释符号#删掉，如果没有上面两行则自己编辑保存。然后reboot系统。</p>
<h6 id="2-_安装i2c-tools">2. 安装i2c-tools</h6><p>sudo apt-get install i2c-tools</p>
<p>顺便推荐个国内的树莓派软件源:<br>deb <a href="http://mirrors.ustc.edu.cn/raspbian/raspbian/" target="_blank" rel="external">http://mirrors.ustc.edu.cn/raspbian/raspbian/</a>   wheezy main contrib non-free rpi<br>编辑/etc/apt/sources.list，注释掉官方源，添加上面那个。重新sudo apt-get update下。</p>
<h6 id="3-_连接MPU6050设备，并测试I2C驱动是否已经OK">3. 连接MPU6050设备，并测试I2C驱动是否已经OK</h6><p>接线只需要四根：电源正3.3V，Ground，SCL，SDA。<br>MPU6050模块上会有标志，与树莓派对齐用杜邦线接好即可。<br>树莓派2的IO定义如图：<br><img src="/images/pi2-I2C-MPU6050/2.png" alt=""></p>
<p>连接好设备后，通过命令：<br>i2cdetect -l<br>查看设备是否已正常工作。如果你的树莓派只接了MPU6050一个I2C设备，对应设备文件为：<br>/dev/i2c-1<br><img src="/images/pi2-I2C-MPU6050/3.png" alt=""></p>
<p>至此I2C驱动已开启，设备工作正常，可以继续写代码访问数据了。</p>
<hr>
<h6 id="4-_代码">4. 代码</h6><p>Github上有个<a href="https://github.com/rpicopter/MotionSensorExample" target="_blank" rel="external">MotionSensorExample</a>用于树莓派对MPU6050/MPU6500/MPU9150/MPU9250的I2C访问。<br>不过笔者clone了代码，在树莓派2上编译失败了。<br>有人也遇到了相同的问题并发了issue#<br><a href="https://github.com/rpicopter/MotionSensorExample/issues/2" target="_blank" rel="external">inv_mpu_lib/inv_mpu.c:392:2: error: expected primary-expression before ‘.’ token</a><br>截至到笔者发此文章时，作者似乎也并未修改该问题（其实就是树莓派2上安装版本的g++编译器不支持C99标准的C struct复合字面量初始化问题）。<br>于是笔者fock了源码，并修复了这个错误。所以这里就用我修改后的<a href="https://github.com/uname/MotionSensorExample" target="_blank" rel="external">MotionSensorExample</a>来测试吧。</p>
<h6 id="5-_编译&amp;&amp;测试">5. 编译&amp;&amp;测试</h6><p>ssh或者serial登陆到树莓派2，clone笔者修改后的MotionSensorExample：</p>
<p>git clone <a href="https://github.com/uname/MotionSensorExample" target="_blank" rel="external">https://github.com/uname/MotionSensorExample</a><br>cd MotionSensorExample<br>make</p>
<p>如果一切OK的，会在MotionSensorExample生成一个测试程序mstest，执行mstest观察数据读数。<br><img src="/images/pi2-I2C-MPU6050/4.png" alt=""></p>
<h6 id="6-_其他">6. 其他</h6><p>MotionSensorExample通过条件编译的方式来支持不同的MPU（6050/6500/9150/9250），只要修改位于MotionSensorExample/MotionSenso下的Makefile即可：<br>CXX_OPTS=-c -DMPU6050 -DMPU_DEBUGOFF -I../libs/</p>
<p>实际上笔者这次测试用的是MPU9250，但是如果编译时使用-DMPU9250，则编译出的程序并不能正确工作，<br>不过既然-DMPU6050可以拿到yaw, pitch, roll数据，暂时也就够用了。错误定位等到有时间再慢慢看吧。</p>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树莓派/">树莓派</a></li></ul>

    </footer>
  
  </div>
  
</article>



    
      <article id="post-use-swig-to-create-python-module" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/14/use-swig-to-create-python-module/">使用swig创建Python模块</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/12/14/use-swig-to-create-python-module/" class="article-date">
  <time datetime="2015-12-14T08:50:40.000Z" itemprop="datePublished">2015-12-14</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>做Python开发，有时出于性能考虑或需要调用已有C/C++实现的东西时，我们就要使用Python的ctypes模块提供的CDLL方法或者自己编写扩展模块。<br>ctypes的CDLL方法对不含有C++类的dll或者so的访问还是比较方便靠谱的，但是对C++类方法的访问似乎不太好用。这时我们就需要自己编写扩展模块了。</p>
<p>编写扩展模块可以使用Python提供的API从0开始实现（比较累），也可以借助boost、swig或者sip等工具库来实现。知名度很高的PyQt4（Qt4的Python绑定）就是使用sip来完成的。<br>这里笔者以上一篇文章介绍的<a href="http://uname.github.io/2015/11/26/minimd5/" target="_blank" rel="external">minimd5</a>项目为例，记录使用swig创建Python扩展模块的方法，以便日后翻查。<br>以下步骤中所述源码，可在笔者上传到github上的<a href="https://github.com/uname/minimd5" target="_blank" rel="external">minimd5</a>项目中找到</p>
<ol>
<li><p>首先安装swig和python开发环境，笔者在ubuntu下使用如下命令完成</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install swig python-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写pyminimd5.c，实现函数: char <em>md5sum(const char </em>const file);<br><img src="/images/use-swig-to-create-python-module/pyminimd5.c.png" alt=""></p>
</li>
<li><p>编写pyminimd5.i，该文件由swig加载生成pyminimd5_wrap.cxx文件，具体方法看下一步中的Makefile代码片段</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%module minimd5</span><br><span class="line">%&#123;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> *md5sum(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">const</span> file);</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> *md5sum(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">const</span> file);</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改minimd5的Makfile，增加用于编译_minimd5.so的代码</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pyminimd5: $(PYMODULE_SOURCES)</span><br><span class="line">    swig -python -c++ pyminimd5.i</span><br><span class="line">    g++ -c pyminimd5.c pyminimd5_wrap.cxx md5.c -I/usr/include/python2.7/ -fPIC</span><br><span class="line">    g++ -shared pyminimd5.o pyminimd5_wrap.o md5.o -o $(PYMODULE_SO)</span><br></pre></td></tr></table></figure>
</li>
<li><p>make pyminimd5生成_minimd5.so，使用Python加载并测试<br><img src="/images/use-swig-to-create-python-module/test.png" alt=""></p>
</li>
</ol>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码笔记/">代码笔记</a></li></ul>

    </footer>
  
  </div>
  
</article>



    
      <article id="post-minimd5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/26/minimd5/">minimd5</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/11/26/minimd5/" class="article-date">
  <time datetime="2015-11-26T07:28:04.000Z" itemprop="datePublished">2015-11-26</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>在kindle电子书的源码中，util-linux_2.12r\lib目录下有md5.c和md5.h两个文件。md5.c实现了计算md5值的算法，且没有外部依赖。md5.h内有一行<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> "../defines.h"</span></span><br></pre></td></tr></table></figure></p>
<p>实际上并不需要defines.h，注视掉即可。利用这两个文件，我们可以实现一个很小的md5计算器，我把它叫做minimd5。源码也灰常简单。已经放在Github上<strong><a href="https://github.com/uname/minimd5" target="_blank" rel="external">minimd5</a></strong></p>
<p>效果如图：</p>
<p><img src="/images/minimd5/snapshort.png" alt=""></p>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/小工具/">小工具</a></li></ul>

    </footer>
  
  </div>
  
</article>



    
      <article id="post-pysockdebugger" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/19/pysockdebugger/">开源的TCP/UDP网络通信调试器</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/11/19/pysockdebugger/" class="article-date">
  <time datetime="2015-11-19T14:32:20.000Z" itemprop="datePublished">2015-11-19</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/我的开源工具/">我的开源工具</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>笔者在参与的一些项目中，经常需要对使用TCP或UDP通信的协议进行调试。除针对业务协议写一些测试客户端或者脚本外，笔者也会借助网上的现有TCP/UDP调试工具做一些简单的连通和ECHO回包测试。<br>用过一些工具，总有些不顺手的地方，于是利用琐碎时间，自己用PyQt4做了一个叫<strong>PySockDebugger</strong>的小东西，<strong>已在Github开源</strong><a href="https://github.com/uname/PySockDebuger" target="_blank" rel="external">PySockDebuger</a>（Debugger误写为Debuger，不再修改）。<br>1.0Beta版本的windows版本已经通过Py2exe打包并上传到Github项目的<a href="https://github.com/uname/PySockDebuger/releases" target="_blank" rel="external">release</a>目录下。欢迎下载体验：）<br>因为使用Python实现，所以在Mac和Linux桌面环境下均可使用（需安装PyQt4，另外有个获取本地IP的小BUG，暂未修改，若使用时遇到，只需按照堆栈错误提示，简单修改下即可）。<br>主要有以下模式:</p>
<ol>
<li>TCP服务器</li>
<li>TCP客户端</li>
<li>UDP服务器(主动绑定本地端口)</li>
<li>UDP客户端</li>
</ol>
<p>另外支持在同一个窗口内创建多个实例，不同的实例在Tab页中显示。下过如下图：<br><img src="/images/pysockdebugger/snapshot.png" alt=""></p>
<p>除重复发送和UDP客户端模式下的绑定本地端口，这两个功能暂未实现外（代码好写，但暂未有时间），其他功能都测试可用。<br>后面打算做个插件功能，由用户实现发送和接收数据的pack和unpack过程，这样在调试不同的协议时，只需加载实现了pack和unpack功能的插件即可。而因为PySockDebuger使用Python实现，这样的插件实现起来还是很方便的。</p>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络与调试/">网络与调试</a></li></ul>

    </footer>
  
  </div>
  
</article>



    
      <article id="post-python-logging" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/04/python-logging/">python的logging模块</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/09/04/python-logging/" class="article-date">
  <time datetime="2015-09-04T14:41:08.000Z" itemprop="datePublished">2015-09-04</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>这里不打算详细介绍logging模块的使用方法，因为该模块使用简单，而且网上也有比较多的介绍文章。<br>仅把个人使用Python写小东西时候的logging模块用法记录下来，以便日后copy</p>
<h6 id="文件_log-py">文件 log.py</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">""</span>)</span><br><span class="line">__formatter = logging.Formatter(<span class="string">"[%(levelname)-7s][%(asctime)s][%(filename)s:%(lineno)d] %(message)s"</span>, <span class="string">"%d %b %Y %H:%M:%S"</span>)</span><br><span class="line">__streamHandler = logging.StreamHandler(sys.stderr)</span><br><span class="line">__streamHandler.setFormatter(__formatter)</span><br><span class="line">__fileHandler = logging.FileHandler(<span class="string">"debug.log"</span>)</span><br><span class="line">__fileHandler.setFormatter(__formatter)</span><br><span class="line"></span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line">logger.addHandler(__streamHandler)</span><br><span class="line">logger.addHandler(__fileHandler)</span><br></pre></td></tr></table></figure>
<h6 id="使用">使用</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> log <span class="keyword">import</span> logger</span><br><span class="line">logger.debug(<span class="string">"this is a debug message"</span>)</span><br><span class="line">logger.warning(<span class="string">"this is a warning message"</span>)</span><br><span class="line">logger.error(<span class="string">"this is a error message"</span>)</span><br></pre></td></tr></table></figure>
<h6 id="效果">效果</h6><p><img src="/images/python-logging/test.png" alt=""></p>

      
    </div>
  
  </div>
  
</article>



    
      <article id="post-ubuntu-samba" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/28/ubuntu-samba/">在ubuntu中配置samba</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/08/28/ubuntu-samba/" class="article-date">
  <time datetime="2015-08-28T15:56:05.000Z" itemprop="datePublished">2015-08-28</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>在虚拟机中安装了一个Ubuntu，用samba访问资源是非常方便的，之前在我的树莓派2中也安装了samba。这里备注下。</p>
<ol>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install samba</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>安装完成后samba的配置目录在/etc/samba下。<br><img src="/images/ubuntu-samba/1.png" alt=""></p>
<ol>
<li>添加用户<br>添加当前用户，需root权限。我的用户名是apache，所以我会这么写：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo smbpasswd <span class="operator">-a</span> apache</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>设置密码，完成添加。<br><img src="/images/ubuntu-samba/2.png" alt=""></p>
<ol>
<li><p>为添加的用户书写配置<br>编辑/etc/samba/smb.conf，我在自己的虚拟机上使用，只需在smb.conf的末尾添加如下配置即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[apache]</span><br><span class="line">   comment = Apache<span class="string">'s Home</span><br><span class="line">   path = /home/apache</span><br><span class="line">   browseable = yes</span><br><span class="line">   read only = no</span><br><span class="line">   guest ok = no</span><br><span class="line">   create mask = 0600</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启samba，完成配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/samba restart</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/images/ubuntu-samba/3.png" alt=""></p>
<p>现在Windows下敲击Win+R，输入\ubuntu-ip\apache<br>可以愉快的从windows资源管理器访问ubuntu下apache用户主目录下的文件了：）</p>

      
    </div>
  
  </div>
  
</article>



    
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
      </nav>
    </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 HeQingwei&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>